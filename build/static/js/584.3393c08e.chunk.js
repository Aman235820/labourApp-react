"use strict";(self.webpackChunklabour_app_react=self.webpackChunklabour_app_react||[]).push([[584],{3387:(e,a,t)=>{t.d(a,{DU:()=>l,DY:()=>r,Lx:()=>i,hG:()=>c});var s=t(9722);const n="".concat("http://localhost:4000","/labourapp"),r=async(e,a)=>{try{const t="".concat(n,"/auth/registerUser?otp=").concat(a);return(await s.A.post(t,e,{headers:{"Content-Type":"application/json",Accept:"application/json"},withCredentials:!0})).data}catch(r){var t;throw(null===(t=r.response)||void 0===t?void 0:t.data)||r.message}},i=async e=>{let{mobileNumber:a,otp:t}=e;try{const e="".concat(n,"/auth/userLogin?otp=").concat(t);return(await s.A.post(e,{mobileNumber:a},{headers:{"Content-Type":"application/json",Accept:"application/json"},withCredentials:!0})).data}catch(i){var r;throw(null===(r=i.response)||void 0===r?void 0:r.data)||i.message}},l=async(e,a)=>{try{const t="".concat(n,"/auth/requestOTP");return(await s.A.post(t,{mobile:e,role:a},{headers:{"Content-Type":"application/json",Accept:"application/json"},withCredentials:!0})).data}catch(r){var t;throw(null===(t=r.response)||void 0===t?void 0:t.data)||r.message}},c=async e=>{try{const a="".concat(n,"/admin/removeUser/").concat(e);return(await s.A.delete(a,{headers:{"Content-Type":"application/json",Accept:"application/json"},withCredentials:!0})).data}catch(t){var a;throw(null===(a=t.response)||void 0===a?void 0:a.data)||t.message}}},7584:(e,a,t)=>{t.r(a),t.d(a,{default:()=>j});var s=t(9379),n=t(5043),r=t(3519),i=t(1072),l=t(8602),c=t(8628),o=t(3722),d=t(7994),m=t(4282),u=t(7417),p=t(4858),h=t(3387),x=t(3216),b=t(3204),g=t(579);const j=()=>{const{register:e,handleSubmit:a,formState:{errors:t},getValues:j}=(0,p.mN)(),N=(0,x.Zp)(),[v,y]=(0,n.useState)(!1),[A,f]=(0,n.useState)(""),[w,T]=(0,n.useState)(""),[C,P]=(0,n.useState)(!1),[S,k]=(0,n.useState)(!1);(0,n.useEffect)((()=>{if(A){const e=setTimeout((()=>f("")),2e3);return()=>clearTimeout(e)}}),[A]),(0,n.useEffect)((()=>{if(w&&w.toLowerCase().includes("success")){const e=setTimeout((()=>T("")),2e3);return()=>clearTimeout(e)}}),[w]);return(0,g.jsx)(r.A,{className:"mt-5 mb-5",children:(0,g.jsx)(i.A,{className:"justify-content-center",children:(0,g.jsx)(l.A,{md:8,lg:6,children:(0,g.jsx)(c.A,{className:"shadow-lg border-0",children:(0,g.jsxs)(c.A.Body,{className:"p-5",children:[(0,g.jsxs)("div",{className:"text-center mb-4",children:[(0,g.jsx)("h2",{className:"fw-bold text-primary",children:"Welcome Back"}),(0,g.jsx)("p",{className:"text-muted",children:"Sign in to continue to InstaLab"})]}),A&&(0,g.jsxs)("div",{className:"alert alert-danger d-flex align-items-center",role:"alert",children:[(0,g.jsx)(b.TNq,{className:"me-2"}),A]}),(0,g.jsxs)(o.A,{onSubmit:a((async e=>{try{y(!0),f("");const a=await(0,h.Lx)({mobileNumber:e.mobileNumber,otp:e.otp});a.token&&a.returnValue?(localStorage.setItem("user",JSON.stringify((0,s.A)((0,s.A)({},a.returnValue),{},{token:a.token}))),window.dispatchEvent(new Event("userLoginStatusChanged")),N("/userHome")):f("Login failed. Please try again.")}catch(A){f(A.message||"Login failed. Please try again.")}finally{y(!1)}})),children:[(0,g.jsxs)(o.A.Group,{className:"mb-4",children:[(0,g.jsxs)("div",{className:"d-flex align-items-center",children:[(0,g.jsx)(b.Cab,{className:"me-2"}),(0,g.jsx)(o.A.Label,{className:"fw-bold mb-0",children:"Mobile Number"})]}),(0,g.jsxs)(d.A,{children:[(0,g.jsx)(o.A.Control,(0,s.A)((0,s.A)({type:"tel",placeholder:"Enter your mobile number",className:"form-control-lg ".concat(t.mobileNumber?"is-invalid":"")},e("mobileNumber",{required:"Mobile number is required",pattern:{value:/^[0-9]{10}$/,message:"Please enter a valid 10-digit mobile number"},onChange:e=>{const a=e.target.value.replace(/\D/g,"").slice(0,10);e.target.value=a}})),{},{maxLength:"10"})),(0,g.jsx)(m.A,{variant:"outline-primary",type:"button",onClick:async()=>{T(""),P(!0);const e=j("mobileNumber");if(!e||!/^[0-9]{10}$/.test(e))return T("Please enter a valid 10-digit mobile number before requesting OTP."),void P(!1);try{await(0,h.DU)(e,"USER"),T("OTP sent successfully!")}catch(a){T(a.message||"Failed to send OTP.")}finally{P(!1)}},disabled:C,children:C?"Sending OTP...":"Request OTP"})]}),t.mobileNumber&&(0,g.jsx)(o.A.Text,{className:"text-danger",children:t.mobileNumber.message}),w&&(0,g.jsx)(o.A.Text,{className:w.includes("success")?"text-success":"text-danger",children:w})]}),(0,g.jsxs)(o.A.Group,{className:"mb-4",children:[(0,g.jsxs)("div",{className:"d-flex align-items-center",children:[(0,g.jsx)(b.pXu,{className:"me-2"}),(0,g.jsx)(o.A.Label,{className:"fw-bold mb-0",children:"OTP"})]}),(0,g.jsxs)(d.A,{children:[(0,g.jsx)(o.A.Control,(0,s.A)((0,s.A)({type:S?"text":"password",placeholder:"Enter OTP",className:"form-control-lg ".concat(t.otp?"is-invalid":"")},e("otp",{required:"OTP is required",pattern:{value:/^[0-9]{4,6}$/,message:"Please enter a valid 4 to 6-digit OTP"}})),{},{maxLength:"6"})),(0,g.jsx)(m.A,{variant:"outline-secondary",type:"button",onClick:()=>k((e=>!e)),tabIndex:-1,children:S?(0,g.jsx)(b.mx3,{}):(0,g.jsx)(b.Ny1,{})})]}),t.otp&&(0,g.jsx)(o.A.Text,{className:"text-danger",children:t.otp.message})]}),(0,g.jsx)("div",{className:"d-grid gap-2",children:(0,g.jsx)(m.A,{variant:"primary",type:"submit",className:"btn-lg fw-bold d-flex align-items-center justify-content-center",disabled:v,children:v?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(u.A,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true",className:"me-2"}),"Signing In..."]}):(0,g.jsxs)(g.Fragment,{children:["Sign In ",(0,g.jsx)(b.Z0P,{className:"ms-2"})]})})}),(0,g.jsx)("div",{className:"text-center mt-4",children:(0,g.jsxs)("p",{className:"mb-0",children:["Don't have an account?"," ",(0,g.jsx)(m.A,{variant:"link",className:"p-0 text-decoration-none",onClick:()=>N("/register"),children:"Register here"})]})})]})]})})})})})}}}]);
//# sourceMappingURL=584.3393c08e.chunk.js.map